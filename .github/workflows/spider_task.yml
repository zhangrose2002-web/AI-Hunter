name: AI Hunter Engine Sync

on:
  # 1. 响应 spider.html 控制台发出的远程指令
  repository_dispatch:
    types: [run-spider]
  
  # 2. 每天凌晨 2 点自动运行 (18:00 UTC = 02:00 CST)
  schedule:
    - cron: '0 18 * * *' 
  
  # 3. 允许在 GitHub 界面上手动点击运行
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Dependencies
        run: |
          pip install requests beautifulsoup4
          # 如果你的 spider.py 以后需要用到这些库，先在这里装好

      - name: Run Spider Engine
        run: python spider.py
        # 这一步会执行爬取、生成 data.json、并上传到你的阿里云 FTP

      - name: Commit and Push Changes
        run: |
          git config --global user.name "AI-Hunter-Bot"
          git config --global user.email "bot@insight.ai"
          
          # 【关键修改】现在只追踪 data.json 的变化
          # 因为 index.html 已经是动态模板，不再被爬虫修改
          git add data.json
          
          # 提交更改，如果没有变化则直接跳过
          git commit -m "Update Leads Data: $(date)" || exit 0
          git push
